# PWA · Web Push 설정 (직접 해야 할 것)

앱을 닫아도 휴대폰/PC에 알림이 오려면 **VAPID 키**를 생성해 `.env`에 넣어야 합니다.

## 1. VAPID 키 생성 및 .env 설정

1. 터미널에서 실행:
   ```bash
   npx web-push generate-vapid-keys
   ```
2. 출력된 **Public Key**와 **Private Key**를 복사합니다.
3. `.env`에 다음 변수를 추가/수정합니다 (Public Key는 두 곳에 동일하게):

   ```env
   VAPID_PUBLIC_KEY="<위에서 복사한 Public Key>"
   VAPID_PRIVATE_KEY="<위에서 복사한 Private Key>"
   NEXT_PUBLIC_VAPID_PUBLIC_KEY="<위와 동일한 Public Key>"
   ```

   - `VAPID_PUBLIC_KEY` / `VAPID_PRIVATE_KEY`: 서버에서 푸시 발송 시 사용  
   - `NEXT_PUBLIC_VAPID_PUBLIC_KEY`: 브라우저에서 구독 시 사용 (없으면 클라이언트가 `/api/push/vapid`에서 받아옴)

4. (선택) 발신자 식별용 이메일:
   ```env
   VAPID_SUBJECT="mailto:your@email.com"
   ```

설정 후 서버를 재시작하세요.

## 2. PWA 아이콘 (선택)

`public/icon-192.png`, `public/icon-512.png`를 넣으면 앱 설치·알림 아이콘으로 사용됩니다. 없어도 푸시는 동작합니다.

## 3. 휴대폰에서 알림 받기 (수신자 설정)

**채팅/소통방 메시지를 휴대폰에서 받으려면**, 해당 계정으로 휴대폰에서 한 번만 아래 순서대로 하면 됩니다.

1. **휴대폰 브라우저**에서 서비스 주소로 접속합니다. (예: `https://jdicompany.vercel.app`)
2. **해당 계정(예: 효태)**으로 로그인합니다.
3. 로그인 후 **대시보드**(첫 화면)가 뜨면, 브라우저에서 **「알림 허용」** 팝업이 나올 수 있습니다.  
   - **「허용」**을 누릅니다.  
   - 팝업이 안 나오면: 브라우저 주소창 왼쪽 자물쇠/정보 아이콘 → **사이트 설정** → **알림**을 **허용**으로 바꿉니다.
4. 이렇게 하면 **그 휴대폰**이 “해당 계정의 기기”로 서버에 등록됩니다.  
   - 이후 누군가 그 계정에게 채팅을 보내면, **그 휴대폰으로 푸시 알림**이 갑니다.

**요약:**  
- 휴대폰에서 **해당 계정으로 로그인** → **알림 허용** 한 번만 하면, 그 폰은 그 계정의 알림 수신 기기로 등록됩니다.  
- PC에서 로그인하고 알림 허용하면 PC에도 알림이 옵니다. 기기별로 한 번씩만 허용하면 됩니다.

## 4. 동작 요약

- **대시보드**에 로그인한 사용자가 **알림 허용**을 하면 해당 기기 구독이 DB에 저장됩니다.
- **소통방(채팅)** 메시지, 작업/댓글/휴가 승인 등으로 알림이 생성될 때마다 해당 사용자에게 **Web Push**가 발송됩니다.
- 앱을 닫아도 **Service Worker**가 푸시를 받아 기기 알림으로 띄우고, 알림을 누르면 해당 화면(예: 해당 채팅방)으로 이동합니다.
